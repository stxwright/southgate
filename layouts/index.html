{{ define "main" }}
<article class="home-page">
    <header>
        <h1>{{ .Title }}</h1>
    </header>
    
    <div class="content">
        {{ .Content }}
    </div>
    
    {{ $threshold := now.AddDate 0 0 -6 }}
    {{ $upcoming := (where (where .Site.RegularPages "Section" "rides") "Date" "ge" $threshold) }}
    {{ if $upcoming }}
    <section class="upcoming-events">
        <h2>Upcoming Rides</h2>
        <div class="events-list">
            {{ range first 3 ($upcoming.ByDate) }}
            <div class="event-card">
                <div class="event-date">
                    <span class="day">{{ .Date.Format "02" }}</span>
                    <span class="month">{{ .Date.Format "Jan" }}</span>
                </div>
                <div class="event-details">
                    <h3><a href="{{ .Permalink }}">{{ .Title }}</a></h3>
                    <div class="event-meta">
                        <span>‚è∞ {{ .Params.time }}</span>
                        <span>üìç {{ .Params.location }}</span>
                        
                        {{ if .Params.route }}
                            {{ $route := .Site.GetPage (printf "/routes/%s" .Params.route) }}
                            {{ if $route }}
                                <span>üó∫Ô∏è <a href="{{ $route.Permalink }}">Route: {{ $route.Title }}</a></span>
                            {{ end }}
                        {{ end }}
                        
                        <span class="pace-badge pace-{{ .Params.pace }}">{{ .Params.pace | title }}</span>
                    </div>
                </div>
            </div>
            {{ end }}
        </div>
        <p class="view-all"><a href="{{ "/rides/" | relURL }}">View all rides ‚Üí</a></p>
    </section>
    {{ end }}

    <section class="gazette-preview">
        <h2>Latest from the Gazette</h2>
        <div class="gazette-grid-simple">
            {{ range first 3 (where .Site.RegularPages "Section" "gazette") }}
            <div class="gazette-card-simple">
                {{ if .Params.image }}
                <div class="gazette-thumb">
                    <a href="{{ .Permalink }}"><img src="{{ .Params.image }}" alt="{{ .Title }}"></a>
                </div>
                {{ end }}
                <div class="gazette-card-content">
                    <h3><a href="{{ .Permalink }}">{{ .Title }}</a></h3>
                    <time>{{ .Date.Format "January 2, 2006" }}</time>
                </div>
            </div>
            {{ end }}
        </div>
        <p class="view-all"><a href="{{ "/gazette/" | relURL }}">View more news ‚Üí</a></p>
    </section>
</article>
{{ end }}
